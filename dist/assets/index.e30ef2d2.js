const H=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerpolicy&&(c.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?c.credentials="include":o.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(o){if(o.ep)return;o.ep=!0;const c=n(o);fetch(o.href,c)}};H();const Z=(e,t)=>t.some(n=>e instanceof n);let W,q;function G(){return W||(W=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Y(){return q||(q=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const V=new WeakMap,A=new WeakMap,$=new WeakMap,D=new WeakMap,M=new WeakMap;function J(e){const t=new Promise((n,r)=>{const o=()=>{e.removeEventListener("success",c),e.removeEventListener("error",s)},c=()=>{n(h(e.result)),o()},s=()=>{r(e.error),o()};e.addEventListener("success",c),e.addEventListener("error",s)});return t.then(n=>{n instanceof IDBCursor&&V.set(n,e)}).catch(()=>{}),M.set(t,e),t}function Q(e){if(A.has(e))return;const t=new Promise((n,r)=>{const o=()=>{e.removeEventListener("complete",c),e.removeEventListener("error",s),e.removeEventListener("abort",s)},c=()=>{n(),o()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",c),e.addEventListener("error",s),e.addEventListener("abort",s)});A.set(e,t)}let R={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return A.get(e);if(t==="objectStoreNames")return e.objectStoreNames||$.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return h(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function X(e){R=e(R)}function ee(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...n){const r=e.call(P(this),t,...n);return $.set(r,t.sort?t.sort():[t]),h(r)}:Y().includes(e)?function(...t){return e.apply(P(this),t),h(V.get(this))}:function(...t){return h(e.apply(P(this),t))}}function te(e){return typeof e=="function"?ee(e):(e instanceof IDBTransaction&&Q(e),Z(e,G())?new Proxy(e,R):e)}function h(e){if(e instanceof IDBRequest)return J(e);if(D.has(e))return D.get(e);const t=te(e);return t!==e&&(D.set(e,t),M.set(t,e)),t}const P=e=>M.get(e);function ne(e,t,{blocked:n,upgrade:r,blocking:o,terminated:c}={}){const s=indexedDB.open(e,t),f=h(s);return r&&s.addEventListener("upgradeneeded",u=>{r(h(s.result),u.oldVersion,u.newVersion,h(s.transaction))}),n&&s.addEventListener("blocked",()=>n()),f.then(u=>{c&&u.addEventListener("close",()=>c()),o&&u.addEventListener("versionchange",()=>o())}).catch(()=>{}),f}function re(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",()=>t()),h(n).then(()=>{})}const oe=["get","getKey","getAll","getAllKeys","count"],ie=["put","add","delete","clear"],C=new Map;function O(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(C.get(t))return C.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,o=ie.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(o||oe.includes(n)))return;const c=async function(s,...f){const u=this.transaction(s,o?"readwrite":"readonly");let i=u.store;return r&&(i=i.index(f.shift())),(await Promise.all([i[n](...f),o&&u.done]))[0]};return C.set(t,c),c}X(e=>({...e,get:(t,n,r)=>O(t,n)||e.get(t,n,r),has:(t,n)=>!!O(t,n)||e.has(t,n)}));const j=ne("myDB",1,{upgrade(e){e.createObjectStore("comments"),e.createObjectStore("performance")}});class se{constructor(t={}){const n=this;this.subscribers=[],j.then(async r=>{this.db=r;const o=await r.get("performance","like");o&&this.set("like",o)}),this.state=new Proxy(t,{async set(r,o,c){return r[o]=c,o!=="like"&&(r.like=(r.like||0)+1),n.db&&(await n.db.put("performance",c,o),o!=="like"&&await n.db.put("performance",r.performance,"like")),n.subscribers.forEach(s=>s(r)),!0}})}subscribe(t){if(typeof t!="function")throw new Error("You must subscribe with a function");this.subscribers.push(t),t(this.state)}set(t,n){this.state[t]=n}get(t){return this.state[t]}increment(){this.set("like",(this.get("like")||0)+1)}}const z=new se({performance:0}),F=document.createElement("template");F.innerHTML=`
<style>
h3, h4 {
  font-weight: bold;
  margin: 1rem 0;
}
h3 {
  font-size: 1.4rem;
}
p {
  font-size: .9rem;
  line-height: 1.4rem;
}
strong {
  font-weight: bold;
}
#preference span {
  min-width: 3rem;
  display: inline-block;
  text-align: center;
}
#preference {
  font-weight: bold;
  font-size: 1.4rem;
}

#preference button {
  width: 6rem;
  height: 3rem;
  border: none;
  border-radius: 10px;
  background-color: seagreen;
  color: white;
}
#preference #bntDislike {
  background-color: #ddA333;
}
</style>
  <div>
    <h3></h3>
    <h4></h4>
    <p><strong>Comment:</strong> <span></span></p>
    <p><strong>Commented on: </strong>${new Date}</p>
    <div id="preference"> 
      <span id="like"></span>
    </div>
  </div>`;class ce extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(F.content.cloneNode(!0)),this.likeCount=this.shadowRoot.querySelector("#like")}static get observedAttributes(){return["like"]}attributeChangedCallback(t,n,r){n!==r&&t==="like"&&this.likeCount&&(this.likeCount.textContent=r)}connectedCallback(){this.shadowRoot.querySelector("h3").textContent=`Name: ${this.getAttribute("name")} `,this.shadowRoot.querySelector("h4").textContent=`Email: ${this.getAttribute("email")}  `,this.shadowRoot.querySelector("span").textContent=this.getAttribute("comment"),z.subscribe(t=>{this.setAttribute("like",t.like)})}}async function ae(e,t){return(await j).put("comments",e,t)}async function ue(e){return(await j).getAll("comments").then(t=>{if(t.length)for(let n=0;n<t.length;n++){const r=document.createElement("user-comment");r.setAttribute("name",t[n].usernameValue),r.setAttribute("email",t[n].emailValue),r.setAttribute("comment",t[n].commentValue);const o=document.createElement("button");o.textContent="Like",o.classList.add("like"),o.addEventListener("click",()=>{z.increment()}),e.append(r,o)}console.log(t)})}async function le(){await re("myDB",{blocked(){console.log("deletions is successful")}})}try{self["workbox:window:6.5.3"]&&_()}catch{}function T(e,t){return new Promise(function(n){var r=new MessageChannel;r.port1.onmessage=function(o){n(o.data)},e.postMessage(t,[r.port2])})}function de(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function N(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function fe(e,t){var n;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(n=function(o,c){if(o){if(typeof o=="string")return N(o,c);var s=Object.prototype.toString.call(o).slice(8,-1);return s==="Object"&&o.constructor&&(s=o.constructor.name),s==="Map"||s==="Set"?Array.from(o):s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?N(o,c):void 0}}(e))||t&&e&&typeof e.length=="number"){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}return(n=e[Symbol.iterator]()).next.bind(n)}try{self["workbox:core:6.5.3"]&&_()}catch{}var I=function(){var e=this;this.promise=new Promise(function(t,n){e.resolve=t,e.reject=n})};function B(e,t){var n=location.href;return new URL(e,n).href===new URL(t,n).href}var v=function(e,t){this.type=e,Object.assign(this,t)};function y(e,t,n){return n?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function me(){}var he={type:"SKIP_WAITING"};function U(e,t){if(!t)return e&&e.then?e.then(me):Promise.resolve()}var pe=function(e){var t,n;function r(f,u){var i,a;return u===void 0&&(u={}),(i=e.call(this)||this).nn={},i.tn=0,i.rn=new I,i.en=new I,i.on=new I,i.un=0,i.an=new Set,i.cn=function(){var d=i.fn,l=d.installing;i.tn>0||!B(l.scriptURL,i.sn.toString())||performance.now()>i.un+6e4?(i.vn=l,d.removeEventListener("updatefound",i.cn)):(i.hn=l,i.an.add(l),i.rn.resolve(l)),++i.tn,l.addEventListener("statechange",i.ln)},i.ln=function(d){var l=i.fn,m=d.target,p=m.state,k=m===i.vn,L={sw:m,isExternal:k,originalEvent:d};!k&&i.mn&&(L.isUpdate=!0),i.dispatchEvent(new v(p,L)),p==="installed"?i.wn=self.setTimeout(function(){p==="installed"&&l.waiting===m&&i.dispatchEvent(new v("waiting",L))},200):p==="activating"&&(clearTimeout(i.wn),k||i.en.resolve(m))},i.dn=function(d){var l=i.hn,m=l!==navigator.serviceWorker.controller;i.dispatchEvent(new v("controlling",{isExternal:m,originalEvent:d,sw:l,isUpdate:i.mn})),m||i.on.resolve(l)},i.gn=(a=function(d){var l=d.data,m=d.ports,p=d.source;return y(i.getSW(),function(){i.an.has(p)&&i.dispatchEvent(new v("message",{data:l,originalEvent:d,ports:m,sw:p}))})},function(){for(var d=[],l=0;l<arguments.length;l++)d[l]=arguments[l];try{return Promise.resolve(a.apply(this,d))}catch(m){return Promise.reject(m)}}),i.sn=f,i.nn=u,navigator.serviceWorker.addEventListener("message",i.gn),i}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var o,c,s=r.prototype;return s.register=function(f){var u=(f===void 0?{}:f).immediate,i=u!==void 0&&u;try{var a=this;return function(d,l){var m=d();return m&&m.then?m.then(l):l(m)}(function(){if(!i&&document.readyState!=="complete")return U(new Promise(function(d){return window.addEventListener("load",d)}))},function(){return a.mn=Boolean(navigator.serviceWorker.controller),a.yn=a.pn(),y(a.bn(),function(d){a.fn=d,a.yn&&(a.hn=a.yn,a.en.resolve(a.yn),a.on.resolve(a.yn),a.yn.addEventListener("statechange",a.ln,{once:!0}));var l=a.fn.waiting;return l&&B(l.scriptURL,a.sn.toString())&&(a.hn=l,Promise.resolve().then(function(){a.dispatchEvent(new v("waiting",{sw:l,wasWaitingBeforeRegister:!0}))}).then(function(){})),a.hn&&(a.rn.resolve(a.hn),a.an.add(a.hn)),a.fn.addEventListener("updatefound",a.cn),navigator.serviceWorker.addEventListener("controllerchange",a.dn),a.fn})})}catch(d){return Promise.reject(d)}},s.update=function(){try{return this.fn?U(this.fn.update()):void 0}catch(f){return Promise.reject(f)}},s.getSW=function(){return this.hn!==void 0?Promise.resolve(this.hn):this.rn.promise},s.messageSW=function(f){try{return y(this.getSW(),function(u){return T(u,f)})}catch(u){return Promise.reject(u)}},s.messageSkipWaiting=function(){this.fn&&this.fn.waiting&&T(this.fn.waiting,he)},s.pn=function(){var f=navigator.serviceWorker.controller;return f&&B(f.scriptURL,this.sn.toString())?f:void 0},s.bn=function(){try{var f=this;return function(u,i){try{var a=u()}catch(d){return i(d)}return a&&a.then?a.then(void 0,i):a}(function(){return y(navigator.serviceWorker.register(f.sn,f.nn),function(u){return f.un=performance.now(),u})},function(u){throw u})}catch(u){return Promise.reject(u)}},o=r,(c=[{key:"active",get:function(){return this.en.promise}},{key:"controlling",get:function(){return this.on.promise}}])&&de(o.prototype,c),r}(function(){function e(){this.Pn=new Map}var t=e.prototype;return t.addEventListener=function(n,r){this.Sn(n).add(r)},t.removeEventListener=function(n,r){this.Sn(n).delete(r)},t.dispatchEvent=function(n){n.target=this;for(var r,o=fe(this.Sn(n.type));!(r=o()).done;)(0,r.value)(n)},t.Sn=function(n){return this.Pn.has(n)||this.Pn.set(n,new Set),this.Pn.get(n)},e}());function ge(e={}){const{immediate:t=!1,onNeedRefresh:n,onOfflineReady:r,onRegistered:o,onRegisterError:c}=e;let s;const f=async(u=!0)=>{};return"serviceWorker"in navigator&&(s=new pe("/./sw.js",{scope:"/",type:"classic"}),s.addEventListener("activated",u=>{u.isUpdate?window.location.reload():r==null||r()}),s.register({immediate:t}).then(u=>{o==null||o(u)}).catch(u=>{c==null||c(u)})),f}const ve=ge({onNeedRefresh(){ve(),console.log("Need Refresh")},onOfflineReady(){console.log("Offline Ready")},onRegistered(){console.log("Registered")},onRegisterError(e){console.log("Register Error"),console.error(e)}});window.customElements.define("user-comment",ce);const ye=document.querySelector(".main_container"),we=document.querySelector("#form"),x=document.querySelector("#username"),b=document.querySelector("#email"),E=document.querySelector("#comment"),S=document.querySelector("#input-checkbox"),be=document.querySelector("#clear_bnt"),g=(e,t)=>{const n=e.parentElement,r=n.querySelector(".error");r.innerText=t,n.classList.add("error"),n.classList.remove("success")},w=e=>{const t=e.parentElement,n=t.querySelector(".error");n.innerText="",t.classList.add("success"),t.classList.remove("error")},K=e=>/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase()),Ee=(e,t,n)=>{e===""?g(x,"Username is required"):w(x),t===""?g(b,"Email is required"):K(t)?w(b):g(b,"Provide a valid email address");const o=30-n.length;o===30?g(E,"Comments is required"):o>0?g(E,`${o} more characters required`):w(E),S.checked?w(S):g(S,"Can't proceed as you didn't agree to the terms!")};we.addEventListener("submit",e=>{e.preventDefault();const t=x.value.trim(),n=b.value.trim(),r=E.value.trim();!t||!n||!K(n)||r.length<=30||!S.checked?Ee(t,n,r):(ae({usernameValue:t,emailValue:n,commentValue:r},n),window.location.reload())});be.addEventListener("click",()=>{le(),window.location.reload()});ue(ye);
